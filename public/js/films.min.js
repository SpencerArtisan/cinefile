(function(){"use strict";angular.module("app").controller("FilmsController",["$scope","$routeParams","$resource","$location","$cookieStore","Analytics",function(a,b,c,d,e,f){return f.trackPage("/video/detail/XXX"),a.loading=!1,a.animateStyle="",a.categories=["All Films","Classic Films","Latest Releases"],a.categoryIndex=null!=e.get("categoryIndex")?e.get("categoryIndex"):1,a.ratingFilter=null!=e.get("ratingFilter")?e.get("ratingFilter"):0,a.byDate=null!=e.get("byDate")?e.get("byDate"):!1,a.backgroundImage="batman",a.toggleMode=function(){return a.byDate=!a.byDate,e.put("byDate",a.byDate)},a.modeStyle=function(){return a.byDate?"icon-movie":"icon-calendar"},a.backgroundStyle=function(){return"background-"+a.categoryIndex},a.previousCategory=function(){return a.changeCategory(-1)},a.nextCategory=function(){return a.changeCategory(1)},a.changeCategory=function(b){return a.categoryIndex+=b+a.categories.length,a.categoryIndex%=a.categories.length,e.put("categoryIndex",a.categoryIndex)},a.category=function(){return a.categories[a.categoryIndex]},a.goForward=function(b){return a.go(b,"slide-left")},a.goBackward=function(b){return a.go(b,"slide-right")},a.goUp=function(b){return a.go(b,"")},a.go=function(b,c){return a.animateStyle=c,d.path(""+b)},a.filterStyle=function(){return"rating-"+a.ratingFilter},a.toggleRatingFilter=function(){return a.ratingFilter+=1,a.ratingFilter%=3,e.put("ratingFilter",a.ratingFilter)},a.allFilms=function(){var b,c,d,e,f;if(!a.films)return[];for(e=a.films,f=[],c=0,d=e.length;d>c;c++)b=e[c],a.passesFilter(b)&&f.push(b);return f},a.passesFilter=function(b){return(1!==a.ratingFilter||a.great(b))&&(2!==a.ratingFilter||a.superb(b))?1===a.categoryIndex&&b.year>=1980?!1:2===a.categoryIndex&&b.year<(new Date).getFullYear()-1?!1:!0:!1},a.loadFilms=function(){return a.loadFilmsFromBackend()},a.loadFilm=function(){return a.loadFilmsFromBackend(function(){var b;return a.film.image||(a.film.image="/images/startup-frankenstein.png"),b="<div class='main' style=\"background: url('"+a.film.image+"');background-size:320px 550px;background-repeat: no-repeat\"/>",$("#film-template").append(b)})},a.loadShowing=function(){return a.loadFilmsFromBackend()},a.loadCinema=function(){return a.loadFilmsFromBackend(function(){var b;return b="<iframe width='320' height='500' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src='https://maps.google.co.uk/maps?q="+a.showing.cinema+"+cinema+london&amp;spn=0.028411,0.007193&amp;t=m&amp;output=embed'></iframe>",console.log("Appending map element: "+b),$("#maparea").append(b)})},a.loadFilmsFromBackend=function(d){var e,f;return null==d&&(d=null),a.loading=!0,f=function(c){return a.loading=!1,a.films=c.films,b.id&&(a.film=c.films[parseInt(b.id)]),b.showing_id&&(a.showing=a.film.showings[parseInt(b.showing_id)]),_.each(a.films,function(a,b){return a.id=b,_.each(a.showings,function(a,b){return a.id=b})}),d?d():void 0},e=function(b){return a.loading=!1,console.log("films failed with "+b.status)},c("/films",{},{get:{method:"GET",cache:!0}}).get(f,e)},a.filmsDates=function(){var b,c;return c=function(){var c,d,e,f;for(e=a.allFilms(),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.showings);return f}(),a.showingDates(_.flatten(c))},a.filmDates=function(){return a.film?a.showingDates(a.film.showings):[]},a.showingDates=function(a){var b,c;return b=function(){var b,d,e;for(e=[],b=0,d=a.length;d>b;b++)c=a[b],e.push(c.day_on);return e}(),b=_.uniq(b),_.sortBy(b,function(a){return moment(a)})},a.showingsOn=function(b){var c,d,e,f,g;if(!a.film||!a.film.showings)return[];for(f=a.film.showings,g=[],d=0,e=f.length;e>d;d++)c=f[d],c.day_on===b&&g.push(c);return g},a.filmsOn=function(b){var c,d,e,f,g;for(f=a.allFilms(),g=[],d=0,e=f.length;e>d;d++)c=f[d],a.isOn(c,b)&&g.push(c);return g},a.isOn=function(a,b){return _.some(a.showings,function(a){return a.day_on===b})},a.when_formatted=function(a){return moment(a).format("dddd D MMMM")},a.short_title=function(a){return a?a.title.split("(")[0].trim():""},a.showFilm=function(a){return d.path("/films/"+a)},a.link=function(a){return encodeURIComponent(a.link)},a.great=function(a){return a&&a.rating&&a.rating>86},a.superb=function(a){return a&&a.rating&&a.rating>94}}])}).call(this);